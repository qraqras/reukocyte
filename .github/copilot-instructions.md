# Reukocyte

## お願い
- [MUST]特に指定がない限り日本語で回答してください
- [MUST]絶対に勝手にコードの修正を行わないでください
- [MUST]コードの修正前に方針を説明して必ず了承を得てください
- [SHOULD]処理の流れは図示してください
- [SHOULD]ベンチマーク関連はbenchmarkディレクトリを参照してください

## 現在のタスク
現在、RuboCopとのベンチマーク比較をしています。
小規模ファイルでは目標を達成できていたのですが、10万行の大規模ファイルではRuboCop以下の性能になってしまいました。
一度最小構成にして設計を見直したいです。
ベンチマークテストはhyperfineを使用できます。
- 空実装のルールを回してx14からx16程度であることは確認できました。

## 今後のタスク
このプロジェクトの直近のタスクは以下の通りです:
- 大規模ファイルでのパフォーマンスがRuboCop以下になるので改善する
- Layout/*の実装
- LSP実装
- Reukecyte専用の設定ファイルの設計と実装

## プロジェクトの全体像
### プロジェクト概要
このプロジェクトの概要は以下の通りです:
- RuboCopのすべてのLayoutといくつかの主要なLintをRustで再実装します
- RuboCopのパフォーマンスに関する問題を"部分的に"に解決することが最大の目的です
- RuboCopのすべての機能をRustで再実装することが目的ではありません
- RuboCopに追従するために、機能は少ないほうが良いと考えています
- 関心の中心はLayoutであり、Lintは主要なものに限定して提供します
- RuboCopとのAPI互換は必須です
- RuboCopの設計や実装について互換性を保つ必要はありません(Copのロジックは踏襲します)
- Ruffのような開発体験を提供するためにLSPの一部の機能を実装します(Diagnostics、Formatting、CodeActionsのみ)
- CLIツールとして開発します(gemでの提供は将来的に検討します)
### 数値目標
- RuboCopのサーバモードと比較して少なくとも40倍高速であることを目指します
- RuboCopのCIを20倍程度高速化することを目指します
  - RuboCopの前処理として実行することでRuboCopの実行時間を短縮する想定です
- LayoutはRuboCopの実行結果と100%同じ結果になることを期待します
- LintはRuboCopの実行結果と60%-80%程度同じ結果になることを期待します(主要なLintを10-20個実装すれば達成できる想定です)
### 開発方針
このプロジェクトの開発における方針は以下の通りです:
- 優先順位は以下の通りです
  1. RuboCopとのAPI互換性(既存のRuboCopユーザを取り込みたい)
  2. RuboCop独特の競合解決のロジック(パフォーマンスを犠牲にしても再現する必要があります)
  3. パフォーマンス(パフォーマンスは最大の優位性であるため非常に重要です)
  4. LSP実装(Diagnostics、Formatting、CodeActionsのみで、残りはRubyLSPに任せます)(Ruffのような開発体験を提供するために非常に重要です)
  5. RuboCopの設計や実装の踏襲(まったく重要ではありません)
  6. 最適化(キャッシュや並列化やその他の最適化は最終的な課題です)
- 基本的な設計はRuffを参考にします(RuboCopは局所的に参照する程度にとどめます)
- パーサはRuby純正のPrismを使用します(Rustバインディングを使用します)
